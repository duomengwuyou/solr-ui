/*! create by 2015-11-27*/ 
function showAlert(a){bootbox.alert(a)}function getAmPmTime(){var a=new Date,b=a.getHours(),c=a.getMinutes(),d=a.getSeconds(),e="AM";b>12&&(e="PM",b-=12),0==b&&(b=12),9>=c&&(c="0"+c),9>=d&&(d="0"+d);var f=b+":"+c+":"+d+" "+e;return f}function sendFrame(a,b){var c='<li class="current-user"><img width="30" height="30" src="/public/images/avatar-female.jpg"><div class="bubble"><a class="user-name" >'+b+'</a><p class="message">'+a+'</p><p class="time"><strong>'+getAmPmTime()+"</strong></p></div></li>";$("#conversation_ul").append(c),scrollToBottom()}function receivedFrame(a,b){var c='<li><img width="30" height="30" src="/public/images/avatar-female.jpg"><div class="bubble"><a class="user-name" >'+b+'</a><p class="message">'+a+'</p><p class="time"><strong>'+getAmPmTime()+"</strong></p></div></li>";$("#conversation_ul").append(c),scrollToBottom()}function scrollToBottom(){$("#conversation_div").scrollTop($("#conversation_div")[0].scrollHeight)}function showConButton(){$("#buildCon").css("display","block"),$("#closeCon").css("display","none"),connectedOrNot=!1}function showCloseConButton(){$("#buildCon").css("display","none"),$("#closeCon").css("display","block"),connectedOrNot=!0}function buildConnection(){$("#conversation_ul").empty(),sendFrame("......向服务器发送建立连接请求......","我"),JavaSide.buildConnection({callback:function(a){1==a&&($("#buildCon").css("display","none"),$("#closeCon").css("display","block"))},timeout:5e3,errorHandler:function(a){showAlert("Oops: "+a)}})}function closeConnection(){sendFrame("......向服务器发送关闭连接请求......","我"),JavaSide.closeConnection({callback:function(a){1==a&&showConButton()},timeout:5e3,errorHandler:function(a){showAlert("Oops: "+a)}})}function emptyMessage(){$("#sendMessage").val("")}function customClose(a){bootbox.alert(a,function(){closeWindow()})}function closeWindow(){var a=navigator.userAgent;-1!=a.indexOf("Firefox")||-1!=a.indexOf("Chrome")?window.location.href="about:blank":(window.opener=null,window.open("","_self"),window.close())}var connectedOrNot=!1;$(function(){dwr.engine.setActiveReverseAjax(!0),dwr.engine.setNotifyServerOnPageUnload(!0),JavaSide.pageLoad(userId,{callback:function(){}}),$("#send_message_form").validate({focusInvalid:!0,rules:{sendMessage:{required:!0}},messages:{sendMessage:{required:"发送信息不能为空"}},submitHandler:function(){if(0==connectedOrNot)return showAlert("不在会话中，不能发送消息，请先建立连接。"),void emptyMessage();var a=$("#sendMessage").val();sendFrame(a,"我"),emptyMessage(),JavaSide.sendMessage(a,{timeout:5e3,errorHandler:function(a){showAlert("Oops: "+a)}})}})});